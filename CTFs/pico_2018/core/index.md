# Core

>This program was about to print the flag when it died.
>Maybe the flag is still in this core file that it dumped?
>Also available at /problems/core_1_722685357ac5a814524ee76a3dcd1521 on the shell server.

### [~$ cd ..](../)

We are given an executable and a coredump, so let's analyze it with GDB

> ```
>% gdb core print_flag
>...
>(gdb) info var
>All defined variables:
>
>
>File ./print_flag.c:
>char *hex_chars;
>char *strs[10000];
>
>
>(gdb) print strs
>$1 = {0x8054008 "32e8ce9583bd4fff354053834f56c10f", 0x8054030 "3e7fc0543017f0725b2bfae394955948",
>  0x8054058 "7b73cc8fc97caeef91a8b9b5d5a2efa6", 0x8054080 "a196e16abd65b5446fd18865d17c012a",
>  0x80540a8 "2b10d7b841df613c00e894d654255408", 0x80540d0 "018d835c52bb3e84f6c8aae0e15455c5",
>  0x80540f8 "642e87ad958d40136db17916a6a0c652", 0x8054120 "a812fbf91865878f430cc1277c732c6c",
>  0x8054148 "47f42ed3638fa0ee3ea0fc768eaaa07f", 0x8054170 "763940db35ad68b9669520bbe5595c8c",
>  0x8054198 "2b67b32e8cbe468ac1ff2aa00f95c12e", 0x80541c0 "c857b75330277a13b02dbcebc7089265",
>  0x80541e8 "acd532973bea50d000ebcc68370c9724", 0x8054210 "3f9612d4dce2cc3cc188de1051df8f3b",
>  0x8054238 "ec2fff4cb2f7e24a3c30a4005dfec29a", 0x8054260 "ebadbea609efb29eece80e86c7489d38",
>  0x8054288 "9d54bfab88a3a4180f11e97a1b2a8521", 0x80542b0 "285d7090833375b84c9260c7bf134457",
>  0x80542d8 "ca43ad331768c100e9349fb4ec830dac", 0x8054300 "7e02c35dab56c67afae999d865b6253a",
>  0x8054328 "33cf61c1c2788e378102bea13576aa0d", 0x8054350 "dcd4d959bc13b4b36b519f2d493e43c1",
>  0x8054378 "f95c2a5e7612bc518b21a4efd1d14933", 0x80543a0 "28f5343ab4c61179c9a7d96aa3cfdf2f",
>  0x80543c8 "724a6741c07d2e6e70549bf4fb3ca5b1", 0x80543f0 "70ce70f31703561d77102041b7d5d974",
>  0x8054418 "93203244947eb9b20d22d749e1eba503", 0x8054440 "824c480dc8c717914c3237b199d3fd77",
>  0x8054468 "fb34341fcd7d50e9c1bf96120e5fbc6a", 0x8054490 "7aeae0aad17215ce67dfee1ec7d7332b",
>  0x80544b8 "d05b0f5e0c021c084d72c9080d0302ee", 0x80544e0 "24933f14b16de6523c4f54851891a7fc",
>  0x8054508 "b9ff80332900f5222627aadb26ccdc89", 0x8054530 "588d8b0a41a36c58270c1d7334f00895",
>  0x8054558 "0128c2303d3aa92c0292f0524534dc9d", 0x8054580 "eb5ae8b16eb07ec805a06f2a45f128e0",
>  0x80545a8 "44a2c5324f2bdf3d4ddad0515437c170", 0x80545d0 "5222764b57726afa8d55da62e9aab1b0",
>  0x80545f8 "3d2b3768eda48ae07354db6b50602105", 0x8054620 "e302a7a845ccfac6e1abd0721d23e28c",
>  0x8054648 "59ef0974e31ded3cfd7cdeeeb0192a68", 0x8054670 "3473df7b28806bc584162f4ef6710d93",
>  0x8054698 "216f0db2633cff1732d612408b189bbb", 0x80546c0 "c1ace5e4910811f43da4fe47a6f31aed",
>  0x80546e8 "b899e7e79efa0ee3b98a7c112043a205", 0x8054710 "b9f91d0abf4bd2f9b73335465990ba56",
>  0x8054738 "34f41fede28c5750e832d883113cb83f", 0x8054760 "d23e22b044c9b1aaadc754a65d316603",
>  0x8054788 "831a5dba173c9d63b2a0657c2ad80db8", 0x80547b0 "0d36ae0b537e1e1c0cc71333d0cdd76d",
>  0x80547d8 "493e739c71b8fc4f806949d199f60545", 0x8054800 "e735bd12ecad9ec1e3b2c84613c18066",
>  0x8054828 "8ab37c559f22de3b1eee6247509d1f39", 0x8054850 "9ec0a153075d6987765e895daeabed47",
>  0x8054878 "b0861d915feb862fd8d5133b1d6fba76", 0x80548a0 "afcbc6c15acd1fce7a38d64e4aef555f",
>  0x80548c8 "42b0872d2ea3d61404ddb1cfbae0f303", 0x80548f0 "5b3d25a44471b86bd398457ff50e801e",
>  0x8054918 "b4bda62ea9f5251f8a7cfece3ccbcd97", 0x8054940 "154bb69509b2ec1768356f39bf47ceed",
>  0x8054968 "339e9239bebaac10445a483f78736519", 0x8054990 "8a72cab897233348792b26b9e2d47ed0",
>  0x80549b8 "8424edc74eb81f09824a8f4611a9f797", 0x80549e0 "bbba881d6c58b51475e0526631f28894",
>---Type <return> to continue, or q <return> to quit---
>  0x8054a08 "35ecdf93ceb73cba2aa7c1d02d2a5ce9", 0x8054a30 "1c5ece18cdff9b9b54215017d41200b1",
>  0x8054a58 "c0f8e00ad097b320751c533274474081", 0x8054a80 "079f7a95a3c56e5d36989ca00f75ff6f",
>  0x8054aa8 "6fee9833bf81dde1479d34e335825e1b", 0x8054ad0 "e0978cb3b34912a5932c70fa68cb6e64",
>  0x8054af8 "e0c6c798ad1bfb08e3463309bd42bb69", 0x8054b20 "b2f798f450f4b0ca3006300fd418f71a",
>  0x8054b48 "a023817d271d7d7ad701800551e48ff2", 0x8054b70 "01682d64472b5952163963eb4c0dcffc",
>  0x8054b98 "05423a7729372893edc50b057023f1ff", 0x8054bc0 "742ae9102474d18be40ef13715a17a0e",
>  0x8054be8 "e28cb9dde42b5a63e72e8559bfa29b07", 0x8054c10 "d849116f58ab21e180f06491343df34c",
>  0x8054c38 "b85c9ccf46a7788f97ffb90ed3bc6081", 0x8054c60 "8ed2a91e0b573d7c46bffbece9849152",
>  0x8054c88 "f349c57c0d43ab0f1be17cd566af7f16", 0x8054cb0 "25ffa6ba3feeaedc9bd08a6e00d7ffd2",
>  0x8054cd8 "4c1f3c96c746512fdff5a53a5025ff74", 0x8054d00 "c83f4c504a79b98898d3d0d31f80ff4b",
>  0x8054d28 "77ab4fc89315cad52b8fb62c5ad491f0", 0x8054d50 "99cd9852b67705d2052bb481f558659f",
>  0x8054d78 "e5c7d1a881f86cb62d2d1ae0f4959257", 0x8054da0 "71f439cbab318e7ab97d36d2a6838daf",
>  0x8054dc8 "e9312fcdb0e3e5daf472a454bd73a238", 0x8054df0 "b6ae66b16945e1fd5600a5452c9cec49",
>  0x8054e18 "2e78529bbd0aef745740c85e4ea2afcd", 0x8054e40 "d3526fe1cebbe3f3a337b9507022fefc",
>  0x8054e68 "24f83d90b5b98ad2d0989f81fb3e92ab", 0x8054e90 "693a6da225baf8cc96425d3486218cdf",
>  0x8054eb8 "609cd3ef8a97263bc7e1415c87e03bf9", 0x8054ee0 "b869b483e2a18dc45a59ca641444f4ea",
>  0x8054f08 "c4388cb7e68634a8ff2b98fac3eb7c54", 0x8054f30 "09c95703d891c39b2b6b355f93a00040",
>  0x8054f58 "909e89151a6ed09fb0af5fee29f29332", 0x8054f80 "4c0c6117b8588f73f1240132a2535859",
>  0x8054fa8 "455a6721f79760a51da1ed38f8b400e5", 0x8054fd0 "53fba1c9950f5b568f76caeb39f39d8e",
>  0x8054ff8 "189b9552a52f07586ce26cd95cdea5cb", 0x8055020 "d567ab941b3128a848ab574a419e7594",
>  0x8055048 "bfb5b5ac0dd367ba0655daf1b8f2e879", 0x8055070 "82e378f86cbc4664cc9a68b11b4f3b8b",
>  0x8055098 "d6e5fdd5a81ee72b3b5930b4bf3faba7", 0x80550c0 "29c1696017e0e0b2b0bf063c57bf2574",
>  0x80550e8 "e355db5e24e149309efa526a91ac6105", 0x8055110 "46a11f043e58888167bb916320f91fe5",
>  0x8055138 "587777bb503d8bfe2aabc0ee0d71d562", 0x8055160 "dd95440a437ce6b015bd5ab573648c76",
>  0x8055188 "a0be5b89e06c61c7674b100936db241c", 0x80551b0 "5cba7335391aad1056b66bf91d441606",
>  0x80551d8 "2b0af4f2d1c8ee8344aaf9316758d5e0", 0x8055200 "1fa03920af89d1c156b40e565ae30d31",
>  0x8055228 "cd1f63f128af960edb2d983f2222f53b", 0x8055250 "24a8899a13aaaa876b4f37e590885b37",
>  0x8055278 "0d087928dc377bed62c99bf3b7b12f82", 0x80552a0 "c8a32dcf9f60a4d16aaf59200e13da59",
>  0x80552c8 "20d4d9368972d433ee33754835b0f0a2", 0x80552f0 "076d0a483ba1fe4ec713d5b0b61a7bc7",
>  0x8055318 "2352d9a04413261ed32a8db34ceb7a29", 0x8055340 "d7ba05b49c8c29a0cca5a58e16981b1e",
>  0x8055368 "3c93148b00739136edb83364afdbae9d", 0x8055390 "b21c69779ea20d8ea36d7c21bfc5d538",
>  0x80553b8 "845edc56bf8bc1974f4bb6c658b3eeb6", 0x80553e0 "204fda589e36fcd3b1f68bcd47026c88",
---Type <return> to continue, or q <return> to quit---
>  0x8055408 "cc896d10b46a03eb4d1c8dac5aeb6633", 0x8055430 "3bc99e942ff32de7a032ddf28dde4117",
>  0x8055458 "ce05caae991c6030062d410cfda3ecab", 0x8055480 "aa064a4e36a96d963c37d33c1effa9a4",
>  0x80554a8 "4ba85e69402adc0184857c28a184b28f", 0x80554d0 "d2730ec5eefca0d2458b1a4bbcf6e75c",
>  0x80554f8 "9dfabbf99e54e2628ee98254e4acc085", 0x8055520 "d7f82e1cd70b96e15cbde01c4c80c169",
>  0x8055548 "851b427197c3da426f04f104d949aa22", 0x8055570 "03d4645fb129c7b26b76d7aa0e4a96d9",
>  0x8055598 "aad0f2fa323f9f2fa9570f21e6b7c806", 0x80555c0 "3d62f6c28021f409d61d53e39aa52ac5",
>  0x80555e8 "727684904b13f2cc8d9d08192bf46bad", 0x8055610 "d1465d6988c7a9326cf74006cfb2a5f8",
>  0x8055638 "63ec0458c2f6b281f88389a48563a6b0", 0x8055660 "99cad22a420f4903197921ea64d0a804",
>  0x8055688 "1deff093292722a3b1dd2b88f58ae9ef", 0x80556b0 "6ce5c78f1a63c0782454fdde3581e604",
>  0x80556d8 "2f9f61e7b4b8420665b53836dc7c2705", 0x8055700 "6a4db2476ffa1f174cc740d1c4dece32",
>  0x8055728 "87f394af39a58bcd794b92c56a328750", 0x8055750 "e4388e7c7110cdd361ef3b4a58cdf1dd",
>  0x8055778 "605eeda6eb6b93ef4df8832dbeaa0786", 0x80557a0 "7d46afc9a2435239f21753412eb2538d",
>  0x80557c8 "1c3bbf461896bcfae1244656508a4075", 0x80557f0 "da0895ead80840331575bcc0c4b05252",
>  0x8055818 "d6a6b918111514829f84b458808d2eff", 0x8055840 "4a6f3774889ac2c514ad8f51fde1be1f",
>  0x8055868 "87ebe6f6e80bad0c1a9a9eb8b9a77b6f", 0x8055890 "25a0b969274c4585f1f9fa1b4b2b68b8",
>  0x80558b8 "d588ff2166dab6fb7f47952d1497c40a", 0x80558e0 "9828749db776d71465bfbddc163ea383",
>  0x8055908 "cac3f51ac809f2e5795272e882625e51", 0x8055930 "91587623e2de4b3c48ebad42fa449a62",
>  0x8055958 "bba21c6fe3d3e1f29de4a269cbe55470", 0x8055980 "f130d9fccdfaeec7bab6c2f9dde21620",
>  0x80559a8 "7505e01ad04be129bef80f1dcffe51ed", 0x80559d0 "7f25f30c347159a17a979a45933f52cc",
>  0x80559f8 "1e1011c4635bcfc495b2f0893b88d44e", 0x8055a20 "26e37a7ddc9ab5e5b97a9f3dbb58fa71",
>  0x8055a48 "05470b5d7e73358eff98fc5a8b275995", 0x8055a70 "fdcf91c0f4339b18ba1a764f16660fbf",
>  0x8055a98 "d8e69a69eac85d0081af8ee954054b41", 0x8055ac0 "327dcd6b723df3d7586d646b960d24e5",
>  0x8055ae8 "652328eaa17a4419c863cde53f2530ba", 0x8055b10 "5dd86b20c9a0dcaa40d0db61a86e918e",
>  0x8055b38 "f565085c10cfc6907604165cfca8d26c", 0x8055b60 "7d1757377f636f3d5316a7293c10e7d5",
>  0x8055b88 "4eca5f1cf7f5622b6310a49d0aef1b46", 0x8055bb0 "910f01bf8b4ed693aa34ec2f60e8b2e4",
>  0x8055bd8 "3e34ff37a857eeb88ed7bf61f49a67ea", 0x8055c00 "52e411bb9028ed07cde7c48b825e948f",
>  0x8055c28 "66378f21f49e2a5e73547dfff5d9968f", 0x8055c50 "cb64a86acf8e9dc10157f46e93729f16",
>  0x8055c78 "b7a5f0fc07a947a48fb7416d5d0ed148", 0x8055ca0 "9fd8fd4f4f9963de3967ac4f94e662ef",
>  0x8055cc8 "1c719c0db961d4f0d5771b7b05167059", 0x8055cf0 "cca58a234941d41a981b3863d7957ee3",
>  0x8055d18 "b8832b764b71f8b90c445a721179f5ca", 0x8055d40 "d5e005640e506097cdb172483b131ede",
>  0x8055d68 "3be305713c19ca087baeee61984a6299", 0x8055d90 "d7cec3fff09ba9315df3b545d9f3b8c8",
>  0x8055db8 "086cb5ca555fe9036f625b72466ff27f", 0x8055de0 "beb63719c68bf9e6858d0f0456348a33",
---Type <return> to continue, or q <return> to quit---
>  0x8055e08 "8fac6b531de16c7f1fc1ec53288b3beb", 0x8055e30 "a8713c45a260edf0cc1a87dbf56214eb",
>  0x8055e58 "d5c0205c2bc18c1482e09cb911b269e3", 0x8055e80 "fa31b9dd49ed5f1d20ebc94db0019e48",
>  0x8055ea8 "879306150f25f33131cfa1d51d6aba33", 0x8055ed0 "2c7238737986db70c4075dc6a305d38f",
>  0x8055ef8 "0f23796f3e50ad0610d6dac7dcca05a0", 0x8055f20 "4c3c59b87081d98e9547f0ecdb7d01d4"...}
> ```

Let's disassemble routines:

> ```
>(gdb) disas main
>Dump of assembler code for function main:
>   0x080487ec <+0>:     lea    0x4(%esp),%ecx
>   0x080487f0 <+4>:     and    $0xfffffff0,%esp
>   0x080487f3 <+7>:     pushl  -0x4(%ecx)
>   0x080487f6 <+10>:    push   %ebp
>   0x080487f7 <+11>:    mov    %esp,%ebp
>   0x080487f9 <+13>:    push   %ecx
>   0x080487fa <+14>:    sub    $0x4,%esp
>   0x080487fd <+17>:    call   0x80485bb <load_strings>
>   0x08048802 <+22>:    call   0x80487c1 <print_flag>
>   0x08048807 <+27>:    mov    $0x0,%eax
>   0x0804880c <+32>:    add    $0x4,%esp
>   0x0804880f <+35>:    pop    %ecx
>   0x08048810 <+36>:    pop    %ebp
>   0x08048811 <+37>:    lea    -0x4(%ecx),%esp
>   0x08048814 <+40>:    ret
>End of assembler dump.
>(gdb) disas print_flag
>Dump of assembler code for function print_flag:
>  0x080487c1 <+0>:     push   %ebp
>   0x080487c2 <+1>:     mov    %esp,%ebp
>   0x080487c4 <+3>:     sub    $0x18,%esp
>   0x080487c7 <+6>:     movl   $0x539,-0xc(%ebp)
>   0x080487ce <+13>:    mov    -0xc(%ebp),%eax
>   0x080487d1 <+16>:    mov    0x804a080(,%eax,4),%eax
>   0x080487d8 <+23>:    sub    $0x8,%esp
>   0x080487db <+26>:    push   %eax
>   0x080487dc <+27>:    push   $0x804894c				;"your flag is: picoCTF{%s}\n"
>   0x080487e1 <+32>:    call   0x8048410 <printf@plt>
>   0x080487e6 <+37>:    add    $0x10,%esp
>   0x080487e9 <+40>:    nop
>   0x080487ea <+41>:    leave
>   0x080487eb <+42>:    ret
>End of assembler dump.
> ```

It's then pretty obvious that the flag is given by `strings[$eax]`. At `<print_flag+26>`, the value of `$eax` is then `0x804a080+4*0x539` because of lines
<+6>, <+13> and <+16>

The flag is therefore:

> ```
>(gdb) x/wx 0x804a080+4*0x539                                                                                                           
>0x804b564 <strs+5348>:  0x080610f0                                                                                                     
>(gdb) x/s 0x080610f0
>0x80610f0:      "e52f4714963eb207ae54fd424ce3c7d4"
> ```

